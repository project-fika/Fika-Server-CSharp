@using System.Text.RegularExpressions
@using FikaWebApp.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.Extensions.Options

@inject RoleManager<IdentityRole> RoleManager
@inject IOptions<IdentityOptions> IdentityOptions

<AuthorizeView Roles="Admin">
	<Authorized>
		<MudDialog>
			<DialogContent>
				<MudForm @bind-IsValid="@_success" @bind-Errors="@_errors" Spacing="4">
					<MudTextField T="string" Variant="Variant.Filled" Counter="10" MaxLength="10" Label="Username" Required="true" RequiredError="User name is required!" @ref="_usernameField"
								  Validation="@(new Func<string, IEnumerable<string>>(UsernameLength))" Immediate="true" />
					<MudTextField T="string" Variant="Variant.Filled" Counter="0" Label="Password" HelperText="Choose a strong password" @ref="_passwordField"
								  InputType="InputType.Password" Validation="@(new Func<string, IEnumerable<string>>(PasswordStrength))" Required="true"
								  RequiredError="Password is required!" Immediate="true" />
					<MudTextField T="string" Variant="Variant.Filled" Counter="0"
								  Label="Password" HelperText="Repeat the password" InputType="InputType.Password" Required="true"
								  Validation="@(new Func<string, string>(PasswordMatch))" Immediate="true" />
					<MudSelect MultiSelection="true" Placeholder="Select roles..." HelperText="Role Selection" @bind-Value="_roleValue" @bind-SelectedValues="_selectedRoles">
						@foreach (var role in _availableRoles)
						{
							<MudSelectItem T="string" Value="@role">@role</MudSelectItem>
						}
					</MudSelect>
					<MudStack Row Justify="Justify.Center" Spacing="2" Style="width:100%;">
						<MudButton StartIcon="@Icons.Material.Filled.Save" Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!_success)" OnClick="Submit">Add</MudButton>
						<MudButton StartIcon="@Icons.Material.Filled.Cancel" Variant="Variant.Filled" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
					</MudStack>
				</MudForm>
			</DialogContent>
		</MudDialog>
	</Authorized>
	<NotAuthorized>

	</NotAuthorized>
</AuthorizeView>


