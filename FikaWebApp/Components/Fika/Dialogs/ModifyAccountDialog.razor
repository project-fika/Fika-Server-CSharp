@using System.Text.RegularExpressions
@using FikaWebApp.Data
@using Microsoft.AspNetCore.Identity
@using Microsoft.Extensions.Options

@inject RoleManager<IdentityRole> RoleManager
@inject UserManager<ApplicationUser> UserManager
@inject IOptions<IdentityOptions> IdentityOptions
@inject ISnackbar Snackbar;

<AuthorizeView Roles="Admin">
	<Authorized>
		<MudDialog ContentStyle="min-width:400px;">
			<DialogContent>
				<MudForm @bind-IsValid="@_success" @bind-Errors="@_errors" Spacing="4">

					<MudSelect Immediate="true" MultiSelection="true" Placeholder="Select roles..." HelperText="Role Selection" @bind-Value="_roleValue" @bind-SelectedValues="_selectedRoles">
						@foreach (var role in _availableRoles)
						{
							<MudSelectItem T="string" Value="@role">@role</MudSelectItem>
						}
					</MudSelect>

					<MudTextField T="string" Variant="Variant.Filled" Counter="0" Label="Password" HelperText="Choose a strong password" @ref="_passwordField"
								  InputType="InputType.Password" Validation="@(new Func<string, IEnumerable<string>>(PasswordStrength))" Required="true"
								  RequiredError="Password is required!" Immediate="true" />
					<MudTextField T="string" Variant="Variant.Filled" Counter="0"
								  Label="Password" HelperText="Repeat the password" InputType="InputType.Password" Required="true"
								  Validation="@(new Func<string, string>(PasswordMatch))" Immediate="true" />
					<MudButton StartIcon="@Icons.Material.Filled.Key" Variant="Variant.Filled" Color="Color.Success" Disabled="@(!_success)" OnClick="ChangePassword">Change Password</MudButton>

					<MudStack Row Justify="Justify.Center" Spacing="2" Style="width:100%;">
						<MudButton StartIcon="@Icons.Material.Filled.Save" Variant="Variant.Filled" Color="Color.Primary" OnClick="Submit">Save</MudButton>
						<MudButton StartIcon="@Icons.Material.Filled.Cancel" Variant="Variant.Filled" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
					</MudStack>
				</MudForm>
			</DialogContent>
		</MudDialog>
	</Authorized>
	<NotAuthorized>

	</NotAuthorized>
</AuthorizeView>
